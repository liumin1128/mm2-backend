# æ’­å®¢æ–‡ä»¶å­˜å‚¨ç»“æ„ä¼˜åŒ–

## é—®é¢˜
- åŸæ¥ï¼šå­—å¹•æ–‡ä»¶å’ŒéŸ³é¢‘æ–‡ä»¶ä¿å­˜åœ¨ä¸åŒçš„ç›®å½•
- åŸæ¥ï¼šæ–‡ä»¶åæ²¡æœ‰æ˜ç¡®çš„ä»»åŠ¡æ ‡è¯†ï¼Œéš¾ä»¥åŒºåˆ†

## è§£å†³æ–¹æ¡ˆ
æ‰€æœ‰æ’­å®¢æ–‡ä»¶ç°åœ¨ç»Ÿä¸€ä¿å­˜åœ¨ **è¾“å…¥ ID** å’Œ **ä»»åŠ¡ ID** ç»„æˆçš„ç›®å½•ç»“æ„ä¸­ï¼Œä¾¿äºæŒ‰ä¸šåŠ¡çº¿æˆ–ç”¨æˆ·åˆ†ç»„ã€‚

## æ–°çš„å­˜å‚¨ç»“æ„

```
podcast-audio (MinIO bucket)
â”œâ”€â”€ podcast/
â”‚   â””â”€â”€ {inputId}/         # è¾“å…¥æ ‡è¯†ï¼ˆä¸šåŠ¡çº¿/ç”¨æˆ·ç­‰ï¼‰
â”‚       â””â”€â”€ {taskId}/      # ä»»åŠ¡æ ‡è¯†
â”‚           â”œâ”€â”€ audio.mp3  # å®Œæ•´éŸ³é¢‘æ–‡ä»¶ï¼ˆä¸»è¾“å‡ºï¼‰
â”‚           â”œâ”€â”€ subtitles.srt  # å­—å¹•æ–‡ä»¶
â”‚           â”œâ”€â”€ round_0.mp3    # ç¬¬ 0 è½®éŸ³é¢‘ï¼ˆå¯é€‰ï¼‰
â”‚           â”œâ”€â”€ round_1.mp3    # ç¬¬ 1 è½®éŸ³é¢‘ï¼ˆå¯é€‰ï¼‰
â”‚           â””â”€â”€ ...
```

## å˜æ›´è¯´æ˜

### 1. ç›®å½•ç»“æ„å˜æ›´
- **åŸæ¥**: `podcast/{taskId}/...`
- **ç°åœ¨**: `podcast/{inputId}/{taskId}/...`

### 2. æ–‡ä»¶ä½ç½®ï¼ˆå·²æ›´æ–°ï¼‰
- **éŸ³é¢‘æ–‡ä»¶**: `podcast/{inputId}/{taskId}/audio.{format}` âœ“
- **å­—å¹•æ–‡ä»¶**: `podcast/{inputId}/{taskId}/subtitles.srt` âœ“
- **åˆ†è½®éŸ³é¢‘**: `podcast/{inputId}/{taskId}/round_{roundId}.{format}` âœ“

## ä¼˜åŠ¿
1. âœ… æ–‡ä»¶æŒ‰ inputId åˆ†ç»„ï¼Œä¾¿äºç®¡ç†å’ŒæŸ¥è¯¢
2. âœ… åŒä¸€ä»»åŠ¡çš„æ‰€æœ‰æ–‡ä»¶é›†ä¸­åœ¨ä¸€ä¸ªç›®å½•
3. âœ… ç›®å½•ç»“æ„æ¸…æ™°ï¼ˆinputId -> taskId -> æ–‡ä»¶ï¼‰
4. âœ… ä¾¿äºæŒ‰ä¸šåŠ¡çº¿/ç”¨æˆ·è¿›è¡Œå¤‡ä»½å’Œåˆ†æ
5. âœ… æ”¯æŒæœªæ¥æ‰©å±•ï¼ˆå¦‚æ·»åŠ æ—¥å¿—ã€å…ƒæ•°æ®ç­‰ï¼‰

## ä»£ç å˜æ›´
- æ–‡ä»¶: `src/podcast/podcast.service.ts`
- å˜æ›´å†…å®¹:
  1. TaskContext æ¥å£æ·»åŠ  `inputId` å­—æ®µ
  2. createPodcast æ—¶åˆå§‹åŒ– inputId
  3. saveRoundAudio è·¯å¾„æ›´æ–°ä¸º `podcast/{inputId}/{taskId}/round_{roundId}`
  4. uploadFile è·¯å¾„æ›´æ–°ä¸º `podcast/{inputId}/{taskId}/audio`
  5. å­—å¹•ä¸Šä¼ è·¯å¾„æ›´æ–°ä¸º `podcast/{inputId}/{taskId}/subtitles.srt`

## æµ‹è¯•æ–¹æ³•
```bash
# è¿è¡Œç®€å•æµ‹è¯•è„šæœ¬
bash scripts/simple-test.sh

# æŸ¥çœ‹æ–‡ä»¶ç»“æ„ï¼ˆé€šè¿‡ MinIOï¼‰
# bucket: podcast-audio
# path: podcast/{inputId}/{taskId}/
```

## å…¼å®¹æ€§è¯´æ˜
- âœ… æ–°ä»»åŠ¡é‡‡ç”¨æ–°çš„å­˜å‚¨ç»“æ„
- âš ï¸ æ—§ä»»åŠ¡çš„æ–‡ä»¶ä¿æŒåŸä½ç½®
- ğŸ’¡ å¦‚éœ€è¿ç§»æ—§æ•°æ®ï¼Œå¯æ‰‹åŠ¨ç§»åŠ¨æˆ–å†™è¿ç§»è„šæœ¬

